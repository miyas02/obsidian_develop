---

---
### カートに商品を追加する処理

カートは項目Beanのリストで表現する。
カートは顧客が買い物をしている間、保存されている必要があるので、項目Beanのリストはセッション属性に設定する。

### カートに追加するアクションの作成

```java
CartAddAction.java
package chapter25;

import bean.Item;
import bean.Product;
import tool.Action;
import javax.servlet.http.*;
import java.util.ArrayList;
import java.util.List;

public class CartAddAction extends Action {

	@SuppressWarnings("unchecked")
	public String execute(
		HttpServletRequest request, HttpServletResponse response
	) throws Exception {

		HttpSession session=request.getSession();

		int id=Integer.parseInt(request.getParameter("id"));
		リクエストパラメータから、カートに追加する商品番号を取得する処理。
		String型からint型に変換する
		
		----セッション属性からカート（項目Bean)を取得する。------
		List<Item> cart=(List<Item>)session.getAttribute("cart");
		if (cart==null) {
			cart=new ArrayList<Item>();
			session.setAttribute("cart", cart);
		}
		nullを取得したら、カートが未生成なので、カートを生成してセッション属性に設定します。
		----------------------------------------------------------
		
		
		for (Item i : cart) { 商品番号idを使って、これから追加する商品がカート内に存在するかどうかを調べる
			if (i.getProduct().getId()==id) {
				i.setCount(i.getCount()+1); 商品がカート内に存在する場合には、カート内の項目Beanについて、個数を加算する
				return "cart.jsp"; cart.jspをフォワード先に指定する
			}
		}
	
    ----これから追加する商品がカート内に存在しない場合の処理。セッション属性から商品のリストを取得する。----
		List<Product> list=(List<Product>)session.getAttribute("list");
		for (Product p : list) { 
		商品番号を使って、これから追加する商品を商品リストから探す。
		商品が見つかったら、項目Bean(Itemオブジェクト)を作成して、そのProductプロパティに取得した商品Bean(Productオブジェクト)を設定する。
			if (p.getId()==id) {
				Item i=new Item();
				i.setProduct(p);
				i.setCount(1);
				cart.add(i);
			}
		}
		return "cart.jsp";
----------------------------------
	}
}
```

### カートの内容を表示するJSP

```java
cart.jsp
<%@page contentType="text/html; charset=UTF-8" %>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@include file="../header.html" %>
<%@include file="menu.jsp" %>

---カート内にある商品の種類数を表示する----
カートに対して、sizeメソッドを呼び出すことで、cart内の要素数を取得し、表示する。
<c:choose>
	<c:when  test="${cart.size()>0}">
		<p>${cart.size()}種類の商品があります。</p>
		<hr>
	</c:when>
	<c:otherwise>
		<p>カートに商品がありません。</p>
	</c:otherwise>
</c:choose>
------------------------------------------

<table style="border-collapse:separate;border-spacing:10px;">
tableタグでは、セッション属性に保存されたカートの内容を表示する。
<c:forEach var="item" items="${cart}">
	<tr>
	<td>商品${item.product.id}</td>
	<td><img src="image/${item.product.id}.jpg" height="96"></td>
	<td>${item.product.name}</td>
	<td>${item.product.price}円</td>
	<td>${item.count}個</td>
	<td><a href="CartRemove.action?id=${item.product.id}">カートから削除</a></td>　カート内の項目を削除するリンク
	</tr>
</c:forEach>
</table>

<%@include file="../footer.html" %>
```