---

---
セッションは、Webアプリケーションにおいて、各ユーザに固有のデータを格納するための仕組み。
アプリケーションサーバに保存される**セッションID**という識別番号を使ってユーザを区別する。
上記ユーザごとのデータを保持するのが**セッション属性**。

### メソッド

![[セッション synced block]]

### **セッション属性を使った、簡単なショッピングカートのプログラム**

- 追加する商品を指定するJSPファイル
- カートに商品を追加するservlet
- カート内の商品を表示するservlet
- カートを削除するservlet

![[セッション synced block 1]]

```java
(cart-add.jsp)
<%@page contentType="text/html; charset=UTF-8" %>
<%@include file="../header.html" %>

<p>カートに追加する商品を入力してください。</p>
<form action="cart-add" method="post">
商品名<input type="text" name="name">
価格<input type="text" name="price">
<input type="submit" value="追加">
</form>

<%@include file="../footer.html" %>
```

![[セッション synced block 2]]

### カート内の商品を表示するサーブレット

```java
package chapter17;

import bean.Product;
import tool.Page;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.List;
import javax.servlet.ServletException;
import javax.servlet.http.*;
import javax.servlet.http.HttpSession;
import javax.servlet.annotation.WebServlet;

@WebServlet(urlPatterns={"/chapter17/cart-get"})
public class CartGet extends HttpServlet {

	@SuppressWarnings("unchecked")
	public void doGet (
		HttpServletRequest request, HttpServletResponse response
	) throws ServletException, IOException {
		PrintWriter out=response.getWriter();
		Page.header(out);

		HttpSession session=request.getSession(); 
		既存のセッションを取得。このようにセッションを利用するすべてのサーブレットやJSPで取得する必要がある

		List<Product> cart=(List<Product>)session.getAttribute("cart");
		セッション属性からリストを取得する。属性名は、商品を追加するサーブレット（CartAdd.java)と同じcartです。

		for (Product p : cart) {
			out.println("<p>");
			out.println(p.getName());
			out.println("：");
			out.println(p.getPrice());
			out.println("</p>");
		}
		拡張for文を用いて、所得下リストからすべての商品Bean(Product)オブジェクトを取り出し、出力する。

		Page.footer(out);
	}
}
```

### セッション属性の削除

- HttpSessionインターフェースのremoveAttributeメソッドを使って、指定したセッション属性を削除する
- HttpSessionインターフェースのinvalidateメソッドを使って、セッションを終了させる。invalidateメソッドを呼び出すと、すべてのセッションが削除される

```java
package chapter17;

import tool.Page;
import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.*;
import javax.servlet.http.HttpSession;
import javax.servlet.annotation.WebServlet;

@WebServlet(urlPatterns={"/chapter17/cart-remove"})
public class CartRemove extends HttpServlet {

	public void doGet (
		HttpServletRequest request, HttpServletResponse response
	) throws ServletException, IOException {
		PrintWriter out=response.getWriter();
		Page.header(out);

		HttpSession session=request.getSession();
		session.removeAttribute("cart"); セッション属性cartを削除する。

		out.println("カートを削除しました。");
		Page.footer(out);
	}
}
```