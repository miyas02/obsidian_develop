---

---
クッキーはクライアントサイドにデータを保存するための仕組み。
主にセッションを実現するためにつかられる。

サーブレット/JSPでは、ユーザごとのデータを保存するためにクッキーを直接使うことは少なく、セッションを使うことが一般的。セッションではクッキーに保存されるのはセッションIDのみ。

クッキーを表すクラスはjavax.servlet.Cookieクラス。
クッキーを作成するには、Cookieコンストラクタを使う。1つのクッキーは名前と値の組み合わせで構成されていて、いずれも文字列(String型)である。

**Cookieクラスのコンストラクタ**
`Cookie (String name, String value)`
指定した名前と値を持つクッキーを作成する

クッキーには生存期間があり、デフォルトの生存期間はブラウザが終了するまで。
ブラウザが終了した後にもクッキーを保存し、次回のブラウザを起動したときにもクッキーを使用したい場合には、setMaxAgeメソッドを使って生存期間を設定する。

**setMaxAgeメソッド**
`void setMaxAge(int expiry)`
クッキーの生存期間を秒単位で指定する

**addCookieメソッド**
`void addCookie(Cookie cookie)`
引数で指定した名前のクッキーをレスポンスに追加する

### クッキーを追加するサンプル

```java
Add.java
package chapter18;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.Cookie; クッキーを使用するには。クラスをインポート
import javax.servlet.http.*;
import javax.servlet.annotation.WebServlet;

@WebServlet(urlPatterns={"/chapter18/add"})
public class Add extends HttpServlet {

	public void doGet (
		HttpServletRequest request, HttpServletResponse response
	) throws ServletException, IOException {

		String name="name";
		String value="value";
		Cookie cookie=new Cookie(name, value); Cookieクラスのコンストラクタを使って、クッキーを作成。
		cookie.setMaxAge(60*60*24); setMaxAgeメソッドで、クッキーの生存期間を設定。生存期間は1日
		response.addCookie(cookie); addCookieメソッドでクッキーを追加
	}
}
```

### クッキーを取得するプログラム

```java
package chapter18;

@WebServlet(urlPatterns={"/chapter18/get"})
public class Get extends HttpServlet {

	public void doGet (
		HttpServletRequest request, HttpServletResponse response
	) throws ServletException, IOException {
		PrintWriter out=response.getWriter();
		Page.header(out);

		Cookie[] cookies=request.getCookies(); 
		getCookieメソッドでクッキーを取得。
		戻り値はCookieオブジェクトの配列だが、クッキーが存在しないときはnullが返るので、これを下で調べている
		if (cookies!=null) {
			for (Cookie cookie : cookies) { クッキーが存在する場合は、拡張for分を使って、すべてのクッキーを１つ１つ取り出している
				String name=cookie.getName(); getNameメソッド、getValueメソッドで名前と値を取得して出力している
				String value=cookie.getValue();
				out.println("<p>"+name+" : "+value+"</p>");
			}
		} else {
			out.println("クッキーは存在しません");
		}

		Page.footer(out);
	}
}
```

### 日本語を含むクッキー

クッキーの名前や値に日本語を使用する場合、
レスポンスにクッキーを追加する際にURLエンコードを行い、
リクエストからクッキーを取得する際にURLデコードを行う必要がある。

URLエンコードには`java.net.URLEncord`クラスのstaticメソッドであるencodeを使う

**encodeメソッド**
`static String encode(String s,String enc)throws UnsupportedEncodingException`
引数encで指定した文字エンコーディングを用いて、文字列sをエンコードする

デコードに、java.net.URLDecoderクラスのdecodeメソッドを使う

**decodeメソッド
**`**static String decode(String s,String enc) throws UnsupportedEncodingException**`**
引数encで指定した文字エンコーディングを用いて、文字列sをデコードする**

### クッキーを使ったカウンタ

クッキーを取得して内容を調べ、nullでなければ拡張for文で１つ１つ取り出して処理する流れはGet.javaと一緒
クッキーを保存する処理はAdd.javaと同じ

```java
Count.java
package chapter18;

import tool.Page;
import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.*;
import javax.servlet.annotation.WebServlet;

@WebServlet(urlPatterns={"/chapter18/count"})
public class Count extends HttpServlet {

	public void doGet (
		HttpServletRequest request, HttpServletResponse response
	) throws ServletException, IOException {
		PrintWriter out=response.getWriter();
		Page.header(out);

		Cookie[] cookies=request.getCookies();

		Integer count=null; カウンタの値を保存する変数countを宣言し、nullを代入
		if (cookies!=null) {　２回目以降はこれが実行される
			for (Cookie cookie : cookies) {
				if (cookie.getName().equals("count")) {
					count=Integer.valueOf(cookie.getValue());
					break;
				}
			}
		}

		if (count==null) count=0; 最初のアクセスの場合、このif文が実行される。これで変数countの値は0になる
		count++;

		Cookie cookie=new Cookie("count",クッキーの名前 count.toString()クッキーの値、count変数の値を文字列にしている);　カウンタの値をcountという名前のクッキーに保存する
		cookie.setMaxAge(60*60*24);
		response.addCookie(cookie);

		out.println(count);
		Page.footer(out);
	}
}
```
