---

---
### 商品検索アクションの作成

Actionクラスを継承して、FrontControllerクラスを使ってJSPファイルへフォワードする

SearchActionクラスに近い内容だが、異なる点がある。相違点は、検索結果の商品リストをリクエスト属性ではなく、セッション属性に設定する。

```java
ProductAction.java
package chapter25;

import bean.Product;
import dao.ProductDAO;
import tool.Action;
import javax.servlet.http.*;
import java.util.List;

public class ProductAction extends Action {
	public String execute(
		HttpServletRequest request, HttpServletResponse response
	) throws Exception {

		HttpSession session=request.getSession();
		セッションを取得する

		String keyword=request.getParameter("keyword");
		if (keyword==null) keyword="";
		リクエストパラメータから検索キーワードを取得する

		ProductDAO dao=new ProductDAO();
		List<Product> list=dao.search(keyword);
		検索の実行。ProductDAOクラスのsearchメソッドを使って、検索キーワードを商品名に含む商品のリストを取得する。
		検索キーワードがから文字列の場合は、全商品のリストを取得する

		session.setAttribute("list", list);
		商品リストをセッション属性に保存する

		return "product.jsp";
		Product.jspにフォワードする
	}
}
```

### 商品一覧を表示するJSPファイル

ProductActionからフォワードされて、商品一覧を表示するJSPファイルを作成する。
このJSPファイルは、検索キーワードの入力画面も兼ねている。

このJSPではJSTLを使用するため、taglibディレクティブを記述する。

また、このページでもメニューを表示するため、menu.jspをインクルードする

```java
product.jsp
<%@page contentType="text/html; charset=UTF-8" %>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
taglibディレクティブを記述する
<%@include file="../header.html" %>
<%@include file="menu.jsp" %> menu.jspをインクルードする

------検索キーワードを入力するためのフォーム----
<p>検索キーワードを入力してください。</p>
<form action="Product.action" method="post">
<input type="text" name="keyword">
<input type="submit" value="検索">
</form>
----------------------------------------------
<hr>

<table style="border-collapse:separate;border-spacing:10px;">
<c:forEach var="product" items="${list}">　<table>タグに含まれる<tr>(行)や<td>タグ(行）を、JSTLの<c:forEach>タグで繰り返し出力している。
	<tr>
	<td>商品${product.id}</td>
	<td><img src="image/${product.id}.jpg" height="64"></td>
	商品番号はProductオブジェクトのidプロパティから取得できるので、このサンプルのように各Productオブジェクトが変数productに代入されている場合、
	商品画像を表示するための<img>タグは、EL式を使って次のように記述する。
	//<img src="image/${product.id}.jpg">
	<td>${product.name}</td>
	<td>${product.price}円</td>
	<td><a href="CartAdd.action?id=${product.id}">カートに追加</a></td>
	カートに商品を追加するためのリンク。リンクを選択すると、後で作成するCartAdd.Actionにリクエストが送信されますが、このときリンク先のURLにリクエストパラメータを付加して商品番号を渡している。
	</tr>
</c:forEach>
</table>

<%@include file="../footer.html" %>
```