---

---
以下のことを確認する

1. ログインしていること
chapter24で作成したログイン機能を使う。ログインしていない場合は、ログインを促すメッセージを表示する。
2. カートに商品が入っていること
カートに商品が入っていない場合には、カートが空であるというメッセージを表示する。

1,2が確認出来たら、購入画面を表示する。カートの内容と、名前や住所の入力欄を表示する。

### 購入前の確認アクションの追加

```java
PreviewAction.java
package chapter25;

import bean.Item;
import tool.Action;
import javax.servlet.http.*;
import java.util.List;

public class PreviewAction extends Action {
	@SuppressWarnings("unchecked")
	public String execute(
		HttpServletRequest request, HttpServletResponse response
	) throws Exception {
		HttpSession session=request.getSession();
		
		----セッション属性から顧客情報を取得する。----
		if (session.getAttribute("customer")==null) {
			return "preview-error-login.jsp";
		}
		取得した値がnullなら未ログインと判断して、ログインを促すページにフォワードする
		
		List<Item> cart=(List<Item>)session.getAttribute("cart");
		if (cart==null || cart.size()==0) {
			return "preview-error-cart.jsp";
		}
		セッション属性からカートを取得する。カートが存在しない場合は、errorページにフォワードする
		return "purchase-in.jsp";
ログイン済みでカートが空でない場合に、購入画面をフォワード先に指定する
---------------------------------------------
	}
}
```

### 未ログインの場合のJSPファイル

```java
preview-error-login.jsp
<%@page contentType="text/html; charset=UTF-8" %>
<%@include file="../header.html" %>
<%@include file="menu.jsp" %>

購入するには
<a href="../chapter24/login-in.jsp">ログイン</a> ログイン画面のリンク
してください。

<%@include file="../footer.html" %>
```

### カートが空の場合のJSPファイル

```java
preivew-error-cart.jsp
<%@page contentType="text/html; charset=UTF-8" %>
<%@include file="../header.html" %>
<%@include file="menu.jsp" %>

カートに商品がありません。

<%@include file="../footer.html" %>
```

### 購入画面を表示するJSPファイル

```java
purchase-in.jsp
<%@page contentType="text/html; charset=UTF-8" %>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@include file="../header.html" %>
<%@include file="menu.jsp" %>

<p>${cart.size()}種類の商品があります。</p>
カート内にある商品の種類数を表示する処理
<hr>

---カート内を表示する処理----
<table style="border-collapse:separate;border-spacing:10px;">
<c:forEach var="item" items="${cart}">
	<tr>
	<td>商品${item.product.id}</td>
	<td><img src="image/${item.product.id}.jpg" height="96"></td>
	<td>${item.product.name}</td>
	<td>${item.product.price}円</td>
	<td>${item.count}個</td>
	</tr>
</c:forEach>
</table>
------------------------------
<hr>

----名前と住所を入力するためのフォーム------
<form action="Purchase.action" method="post">
<p>お名前 <input type="text" name="name"></p>
<p>ご住所 <input type="text" name="address"></p>
<p><input type="submit" value="購入を確定"></p>
</form>
----------------------------------------------

<%@include file="../footer.html" %>
```