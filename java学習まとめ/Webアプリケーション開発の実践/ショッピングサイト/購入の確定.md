---

---
### 購入アクションの作成

```java
PurchaseAction.java
package chapter25;

import bean.Item;
import dao.PurchaseDAO;
import tool.Action;
import javax.servlet.http.*;
import java.util.List;

public class PurchaseAction extends Action {
	@SuppressWarnings("unchecked")
	public String execute(
		HttpServletRequest request, HttpServletResponse response
	) throws Exception {
		HttpSession session=request.getSession();

-----フォームから送られてきた名前または住所が空の場合-----
		String name=request.getParameter("name");
		String address=request.getParameter("address");
		if (name.isEmpty() || address.isEmpty()) {
			return "purchase-error-empty.jsp";
		}
purchase-error-empty.jspをフォワード先に指定して、エラーメッセージを表示する。
----------------------------------------------------------

-----購入情報の登録---------------
		PurchaseDAO dao=new PurchaseDAO();
		List<Item> cart=(List<Item>)session.getAttribute("cart");
		if (cart==null || !dao.insert(cart, name, address)) {
			return "purchase-error-insert.jsp";
		}
セッション属性からカートを取得し、名前と住所と合わせて、PurchaseDAOのinsertメソッドに渡す。
カートの取得やデータベース処理に失敗した場合には、purchase-error-insert.jspをフォワード先に指定して、エラーメッセージを表示する
		session.removeAttribute("cart");
		return "purchase-out.jsp";
登録に成功した場合。
購入済みのカートを削除するためのremoveAttributeメソッドを使って、セッション属性からカートを削除する。
最後にpurchase-out.jspをフォワード先に指定して、購入が成功したというメッセージを表示する。
------------------------------
	}
}
```

### 各メッセージのJSPファイル

購入成功時のJSPファイル

```java
purchase-out.jsp
<%@page contentType="text/html; charset=UTF-8" %>
<%@include file="../header.html" %>
<%@include file="menu.jsp" %>

購入手続きが完了しました。

<%@include file="../footer.html" %>
```

名前や住所が未入力の際のエラーメッセージのjspファイル

```java
purchase-error-empty.jsp
<%@page contentType="text/html; charset=UTF-8" %>
<%@include file="../header.html" %>
<%@include file="menu.jsp" %>

名前と住所を正しく入力してください。

<%@include file="../footer.html" %>
```

データベース登録時のエラーメッセージ

```java
purchase-error-insert.jsp
<%@page contentType="text/html; charset=UTF-8" %>
<%@include file="../header.html" %>
<%@include file="menu.jsp" %>

購入手続き中にエラーが発生しました。

<%@include file="../footer.html" %>
```