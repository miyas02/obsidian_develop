---

---
アクションタグを活用すると、JSPからjavaプログラムを排して、サーブレットとの使い分けを明確にすることが可能

### アクションタグとアクション

アクションタグは、**JSPからあらかじめ用意されたJavaプログラムを呼び出すための仕組み**。
JSPファイル内にアクションタグを記述すると、そのアクションタグに対応するjavaプログラムを呼び出すことができる。

JSPにあらかじめ用意されているアクションタグは、`<jsp:.>`のような形式で記述し、これにより提供される機能を**標準アクション**と呼ぶ。

### Beanを扱うためのアクション

`<jsp:useBean>`,`<jsp:getProperty>`,`<jsp:setProperty>`

useBeanアクションを使うと、スクリプレットを使わずに、Beanのオブジェクトを生成したり、属性に保存されているBeanのオブジェクトを取得することができる。useBeanアクションは次のように記述する

**useBeanアクション**
`<jsp:useBean id=”Bean名” class = “クラス” scope=”スコープ”/>`

**getPropertyアクション
**`<jsp:getProperty name = “Bean名” property=”プロパティ名”/>`

**setPropertyアクション**
`<jsp:setProperty name = “Bean名” property=”プロパティ名” value=”値”/>`

### アクションタグでBeanを取得するプログラム

サーブレットが生成したBeanをJSPから取得して表示するサンプルをアクションタグを使って改良する

```java
package chapter20;

import bean.Product;
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.*;
import javax.servlet.annotation.WebServlet;

@WebServlet(urlPatterns={"/chapter20/tag"})
public class Tag extends HttpServlet {

	public void doGet (
		HttpServletRequest request, HttpServletResponse response
	) throws ServletException, IOException {

		Product p=new Product();
		p.setId(1);
		p.setName("まぐろ");
		p.setPrice(100);

		request.setAttribute("product", p);
		request.getRequestDispatcher("tag.jsp")
			.forward(request, response);
	}
}
```

```html
<%@page contentType="text/html; charset=UTF-8" %>
<%@include file="../header.html" %>

<jsp:useBean id="product" class="bean.Product" scope="request" />
useBeanアクションは、サーブレット側ですでにBeanが生成されているため、それを取得する処理
Beanの属性名はproduct、Beanのクラスはbean.Productクラスで、リクエスト属性からBeanを取得する

<p>
<jsp:getProperty name="product" property="id" />：
<jsp:getProperty name="product" property="name" />：
<jsp:getProperty name="product" property="price" />
</p>
getPropertyアクションを使ったプロパティの取得。
Bean名は上記のuserBeanアクションに記述したproductを使う。
プロパティから商品番号(id)、商品名(name)、価格(price)を取得して出力する。

<%@include file="../footer.html" %>
```

### Beanを生成するJSP

useBeanアクションを使って、新たにbeanを生成するサンプルを作る
１つのJSPファイルの中でBeanを生成した後に、プロパティの設定を取得する

```html
<%@page contentType="text/html; charset=UTF-8" %>
<%@include file="../header.html" %>

<jsp:useBean id="product" class="bean.Product" /> 
useBeanアクションを使ったBeanの生成。
productというBean名で、bean.ProductクラスのBeanを生成する。スコープの指定を省略しているから、ページ属性に保存される。

<jsp:setProperty name="product" property="id" value="2" />
<jsp:setProperty name="product" property="name" value="サーモン" />
<jsp:setProperty name="product" property="price" value="100" />
setPropertyを使ったプロパティの設定。
商品番号(id)、商品名(name)、価格(price)を設定する

<jsp:getProperty name="product" property="id" />：
<jsp:getProperty name="product" property="name" />：
<jsp:getProperty name="product" property="price" />
getPropertyを使ったプロパティの設定。
上記で設定したプロパティを取得して出力する

	<%@include file="../footer.html" %>.
```

## アクションタグを使ったフォワードとインクルード

サーブレットからほかのリソースへフォワードする場合はforwardメソッドを、インクルードする場合はincludeメソッド使いますが、
JSPでフォワードやインクルードを行う場合は、アクションを利用する。
これらのアクションは、内部的にはforwardメソッドやincludeメソッドを使用して実現されているため、基本的な動作は同じ

### **forwardアクションとincludeアクション**

- forwardアクションは、jspからほかのサーブレットやjspに**処理を移す機能**

**forwardアクション
**`**<jsp:forward page = “パス”/>**`

パスにはフォワード先のサーブレットやJSPファイルを指定する。パスの記法は、getRequestDispatcherメソッドの引数の場合と同じ。

- includeアクションは他のサーブレットやJSPを**呼び出す機能**

**includeアクション
**`**<jsp:include page = “パス”/>**`

### forwardアクションを使ったJSPファイル

```java
<%@page contentType="text/html; charset=UTF-8" %>

<jsp:forward page="/chapter9/forward.jsp" />
forwardアクションを使って、chapter9フォルダのforward.jspにフォワードしている
```

### includeを使ったJSPファイル

```java
<%@page contentType="text/html; charset=UTF-8" %>

<jsp:include page="/chapter9/include1.jsp" />
<jsp:include page="/chapter9/include2.jsp" />
includeアクションを使って、chapter9フォルダのinclude1.jspとinclude2.jspをインクルードする
```